"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("tslib"),n=(t=require("any-event"))&&"object"==typeof t&&"default"in t?t.default:t,r=require("@any-touch/shared");function i(){var t,n,i,a,s=0;return function(c){if(t=n,void 0!==c){var u=function(t,e){var n=t.stage,i=t.points,a=t.changedPoints,s=t.nativeEvent,c=i.length,u=r.INPUT_START===n,v=r.INPUT_END===n&&0===c||r.INPUT_CANCEL===n,l=Date.now(),p=o(i)||o(a),_=p.x,f=p.y,g=s.currentTarget;return Object.assign(t,{id:e,x:_,y:f,timestamp:l,isStart:u,isEnd:v,pointLength:c,currentTarget:g,getOffset:function(t){void 0===t&&(t=g);var e=t.getBoundingClientRect();return{x:_-Math.round(e.left),y:f-Math.round(e.top)}}})}(c,s=Number.MAX_SAFE_INTEGER>s?++s:1);n=u;var v=u.isStart,l=u.pointLength;return v&&(i=u,t=void 0,a=1<l?u:void 0),e.__assign(e.__assign({},u),{prevInput:t,startMultiInput:a,startInput:i})}}}function o(t){var e=t.length;if(0<e){if(1===e){var n=t[0],i=n.clientX,o=n.clientY;return{x:Math.round(i),y:Math.round(o)}}var a=t.reduce((function(t,e){return t.x+=e[r.CLIENT_X],t.y+=e[r.CLIENT_Y],t}),{x:0,y:0});return{x:Math.round(a.x/e),y:Math.round(a.y/e)}}}function a(t,n,r){n.target,n.currentTarget;var i,o=n.type,a=e.__rest(n,["target","currentTarget","type"]);return document.createEvent?(i=document.createEvent("HTMLEvents")).initEvent(o,null==r?void 0:r.bubbles,null==r?void 0:r.cancelable):i=new Event(o,r),Object.assign(i,a,{match:function(){return n.targets.every((function(t){return i.currentTarget.contains(t)}))}}),t.dispatchEvent(i)}var s=[r.TOUCH_START,r.TOUCH_MOVE,r.TOUCH_END,r.TOUCH_CANCEL];function c(t,n){var r=n.type,i=n.target;t.emit(r,n),t.emit("at:after",n),t.options.domEvents&&void 0!==t.el&&null!==i&&(a(i,n,t.options.domEvents),a(i,e.__assign(e.__assign({},n),{_type:n.type,type:"at:after"}),t.options.domEvents))}var u={domEvents:{bubbles:!0,cancelable:!0},preventDefault:!0,preventDefaultExclude:/^(?:INPUT|TEXTAREA|BUTTON|SELECT)$/},v=function(t){function n(o,a){var c,v,l,p=t.call(this)||this;p._$computeFunctionMap={},p._$recognizerMap={},p._$recognizers=[],p.el=o,p.options=e.__assign(e.__assign({},u),a);try{for(var _=e.__values(n._$Recognizers),f=_.next();!f.done;f=_.next()){var g=e.__read(f.value,2),d=g[0],h=g[1];p.use(d,h)}}catch(t){c={error:t}}finally{try{f&&!f.done&&(v=_.return)&&v.call(_)}finally{if(c)throw c.error}}var E,y,M,m,O=function(t){var e=i();return function(n){var r=[],i=[];Array.from(n.touches).forEach((function(e){var n=e.clientX,o=e.clientY,a=e.target;(null==t?void 0:t.contains(a))&&(r.push(a),i.push({clientX:n,clientY:o,target:a}))}));var o=Array.from(n.changedTouches).map((function(t){return{clientX:t.clientX,clientY:t.clientY,target:t.target}}));return e({stage:n.type.replace("touch",""),changedPoints:o,points:i,nativeEvent:n,target:n.target,targets:r})}}(p.el),T=(y=!1,M=null,m=i(),function(t){var e,n=t.clientX,i=t.clientY,o=t.type,a=t.button,s=t.target,c=[{clientX:n,clientY:i,target:s}];r.MOUSE_DOWN===o&&0===a?(M=s,y=!0,e=r.INPUT_START):y&&(r.MOUSE_MOVE===o?e=r.INPUT_MOVE:r.MOUSE_UP===o&&(c=[],e=r.INPUT_END,y=!1));var u=E||[{clientX:n,clientY:i,target:s}];if(E=[{clientX:n,clientY:i,target:s}],void 0!==e)return m({stage:e,changedPoints:u,points:c,target:M,targets:[M],nativeEvent:t})});if(p._$inputCreatorMap=((l={})[r.TOUCH_START]=O,l[r.TOUCH_MOVE]=O,l[r.TOUCH_END]=O,l[r.TOUCH_CANCEL]=O,l[r.MOUSE_DOWN]=T,l[r.MOUSE_MOVE]=T,l[r.MOUSE_UP]=T,l),void 0!==o){o.style.webkitTapHighlightColor="rgba(0,0,0,0)";var U=!1;try{var b={};Object.defineProperty(b,"passive",{get:function(){U=!0}}),window.addEventListener("_",(function(){}),b)}catch(t){}p.on("unbind",function(t,e,n){return s.forEach((function(r){t.addEventListener(r,e,n)})),t.addEventListener(r.MOUSE_DOWN,e,n),window.addEventListener(r.MOUSE_MOVE,e,n),window.addEventListener(r.MOUSE_UP,e,n),function(){s.forEach((function(n){t.removeEventListener(n,e)})),t.removeEventListener(r.MOUSE_DOWN,e,n),window.removeEventListener(r.MOUSE_MOVE,e,n),window.removeEventListener(r.MOUSE_UP,e,n)}}(o,p.catchEvent.bind(p),!(p.options.preventDefault||!U)&&{passive:!0}))}return p}return e.__extends(n,t),n.prototype.target=function(t){var e=this;return{on:function(n,r){e.on(n,r,(function(e){return e.targets.every((function(e){return t.contains(e)}))}))}}},n.prototype.catchEvent=function(t){var n,i,o=this,s=function(){return t.stopPropagation()},u=function(){return t.preventDefault()},v=function(){return t.stopImmediatePropagation()};(function(t,e){if(!e.preventDefault)return!1;var n=!0;if(null!==t.target){var i=e.preventDefaultExclude;if(r.isRegExp(i)){if("tagName"in t.target){var o=t.target.tagName;n=!i.test(o)}}else r.isFunction(i)&&(n=!i(t))}return n})(t,this.options)&&u();var l=this._$inputCreatorMap[t.type](t);if(void 0!==l){var p="at:"+l.stage;this.emit("at",l),this.emit(p,l);var _=this.options.domEvents;if(!1!==_){var f=t.target;null!==f&&(a(f,e.__assign(e.__assign({},l),{type:"at"}),_),a(f,e.__assign(e.__assign({},l),{type:p}),_))}var g=l;for(var d in this._$computeFunctionMap)Object.assign(g,this._$computeFunctionMap[d](g));var h=function(t){if(t.disabled)return"continue";t.recognize(g,(function(n){var r=e.__assign(e.__assign({},g),{type:n,name:t.name,stopPropagation:s,preventDefault:u,stopImmediatePropagation:v});null==Object||Object.freeze(r),void 0===o.beforeEachHook?c(o,r):o.beforeEachHook(t,o._$recognizerMap,(function(){c(o,r)}))}))};try{for(var E=e.__values(this._$recognizers),y=E.next();!y.done;y=E.next()){h(y.value)}}catch(t){n={error:t}}finally{try{y&&!y.done&&(i=E.return)&&i.call(E)}finally{if(n)throw n.error}}}},n.prototype.use=function(t,n){var r,i,o=null==n?void 0:n.name;if(void 0===o||void 0===this._$recognizerMap[o]){var a=new t(n);try{for(var s=e.__values(a.computeFunctions),c=s.next();!c.done;c=s.next()){var u=c.value,v=u._id;void 0===this._$computeFunctionMap[v]&&(this._$computeFunctionMap[v]=u())}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}this._$recognizerMap[a.name]=a,this._$recognizers.push(this._$recognizerMap[a.name])}},n.prototype.removeUse=function(t){var n,r;if(void 0===t)this._$recognizers=[],this._$recognizerMap={};else try{for(var i=e.__values(this._$recognizers.entries()),o=i.next();!o.done;o=i.next()){var a=e.__read(o.value,2),s=a[0];if(t===a[1].options.name){this._$recognizers.splice(s,1),delete this._$recognizerMap[t];break}}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},n.prototype.beforeEach=function(t){this.beforeEachHook=t},n.prototype.get=function(t){return this._$recognizerMap[t]},n.prototype.set=function(t){this.options=e.__assign(e.__assign({},this.options),t)},n.prototype.destroy=function(){this.emit("unbind"),t.prototype.destroy.call(this)},n.version="1.0.13-alpha.0",n._$Recognizers=[],n._$computeFunctionMap={},n.use=function(t,e){n._$Recognizers.push([t,e])},n}(n);exports.default=v;
