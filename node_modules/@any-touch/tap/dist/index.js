"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,i=require("tslib"),e=require("@any-touch/shared"),s=(t=require("@any-touch/recognizer"))&&"object"==typeof t&&"default"in t?t.default:t,o=require("@any-touch/vector"),n=require("@any-touch/compute"),a={name:"tap",pointLength:1,tapTimes:1,waitNextTapTime:300,maxDistance:2,maxDistanceFromPrevTap:9,maxPressTime:250},r=function(t){function s(e){var s=t.call(this,i.__assign(i.__assign({},a),e))||this;return s.computeFunctions=[n.ComputeDistance,n.ComputeMaxLength],s._$tapCount=0,s}return i.__extends(s,t),s.prototype._isValidDistanceFromPrevTap=function(t){if(void 0!==this._$prevTapPoint){var i=o.getVLength({x:t.x-this._$prevTapPoint.x,y:t.y-this._$prevTapPoint.y});return this._$prevTapPoint=t,this.options.maxDistanceFromPrevTap>=i}return this._$prevTapPoint=t,!0},s.prototype._isValidInterval=function(){var t=performance.now();if(void 0===this._$prevTapTime)return this._$prevTapTime=t,!0;var i=t-this._$prevTapTime;return this._$prevTapTime=t,i<this.options.waitNextTapTime},s.prototype.recognize=function(t,s){var o=t.stage,n=t.x,a=t.y;e.INPUT_END===o&&(this.status=e.STATUS_POSSIBLE,this._$test(t)?(clearTimeout(this._$countDownToFailTimer),this._isValidDistanceFromPrevTap({x:n,y:a})&&this._isValidInterval()?this._$tapCount++:this._$tapCount=1,0==this._$tapCount%this.options.tapTimes?(this.status=e.STATUS_RECOGNIZED,s(this.options.name,i.__assign(i.__assign({},t),{tapCount:this._$tapCount})),this._$reset()):this._$countDownToFail()):(this._$reset(),this.status=e.STATUS_FAILED))},s.prototype._$countDownToFail=function(){var t=this;this._$countDownToFailTimer=setTimeout((function(){t.status=e.STATUS_FAILED,t._$reset()}),this.options.waitNextTapTime)},s.prototype._$reset=function(){this._$tapCount=0,this._$prevTapPoint=void 0,this._$prevTapTime=void 0},s.prototype._$test=function(t){var i=t.startInput,e=t.pointLength,s=t.timestamp-i.timestamp,o=t.maxPointLength,n=t.distance;return o===this.options.pointLength&&0===e&&this.options.maxDistance>=n&&this.options.maxPressTime>s},s}(s);exports.default=r;
